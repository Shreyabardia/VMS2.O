<div class="space-y-6 animate-fade-in">
  <!-- Page Header -->
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
    <div>
      <h1 class="text-2xl sm:text-3xl font-bold text-gray-900">Edit User</h1>
      <p class="text-gray-600 mt-1">
        Manage and update user information and permissions
      </p>
    </div>
    <div class="mt-4 sm:mt-0 flex items-center space-x-2">
      <button
        routerLink="/admin/add-user"
        class="flex items-center space-x-2 px-4 py-2 rounded-xl bg-gradient-to-r from-purple-600 to-indigo-600 text-white hover:from-purple-700 hover:to-indigo-700 transition-all duration-300 transform hover:scale-105"
      >
        <i class="fas fa-user-plus"></i>
        <span>Add User</span>
      </button>
    </div>
  </div>

  <!-- Edit User Form Section (inline, not modal, now above the table) -->
  <div *ngIf="isEditing" class="glass-effect rounded-xl p-6 mt-8">
    <div class="flex items-center justify-between mb-6">
      <h3
        class="text-lg font-semibold text-gray-900 flex items-center space-x-2"
      >
        <i class="fas fa-edit text-orange-500"></i>
        <span>Edit User: {{ selectedUser?.userName }}</span>
      </h3>
      <button
        (click)="cancelEdit()"
        class="flex items-center space-x-2 px-4 py-2 rounded-xl border border-gray-300 text-gray-700 hover:bg-gray-50 transition-all duration-300"
      >
        <i class="fas fa-times"></i>
        <span>Cancel</span>
      </button>
    </div>
    <form [formGroup]="editForm" (ngSubmit)="saveUser()" class="space-y-6">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2"
            >User Name <span class="text-red-500">*</span></label
          >
          <input
            type="text"
            formControlName="userName"
            class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200"
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2"
            >Designation <span class="text-red-500">*</span></label
          >
          <select
            formControlName="designation"
            class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200"
          >
            <option value="">Select Designation</option>
            <option *ngFor="let item of designationOptions" [value]="item">
              {{ item }}
            </option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2"
            >User Login <span class="text-red-500">*</span></label
          >
          <input
            type="text"
            formControlName="userLogin"
            class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200"
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2"
            >Email ID <span class="text-red-500">*</span></label
          >
          <input
            type="email"
            formControlName="emailId"
            class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200"
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2"
            >Department</label
          >
          <select
            formControlName="department"
            class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200"
          >
            <option value="">Select Department</option>
            <option *ngFor="let item of departmentOptions" [value]="item">
              {{ item }}
            </option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2"
            >Unit Name</label
          >
          <select
            formControlName="unitName"
            class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200"
          >
            <option value="">Select Unit</option>
            <option *ngFor="let item of unitNameOptions" [value]="item">
              {{ item }}
            </option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2"
            >Role</label
          >
          <input
            type="text"
            formControlName="role"
            class="w-full px-4 py-3 rounded-xl border border-gray-300 bg-gray-50 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200"
            readonly
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2"
            >Status <span class="text-red-500">*</span></label
          >
          <select
            formControlName="status"
            class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200"
          >
            <option value="">Select Status</option>
            <option *ngFor="let item of statusOptions" [value]="item">
              {{ item }}
            </option>
          </select>
        </div>
      </div>
      <div class="flex flex-col sm:flex-row gap-4 pt-6">
        <button
          type="submit"
          [disabled]="editForm.invalid"
          class="flex-1 flex items-center justify-center space-x-2 px-6 py-3 rounded-xl bg-gradient-to-r from-orange-500 to-yellow-500 text-white font-medium hover:from-orange-600 hover:to-yellow-600 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 transform hover:scale-105"
        >
          <i class="fas fa-save"></i>
          <span>Save Changes</span>
        </button>
        <button
          type="button"
          (click)="cancelEdit()"
          class="flex-1 flex items-center justify-center space-x-2 px-6 py-3 rounded-xl border border-gray-300 text-gray-700 font-medium hover:bg-gray-50 transition-all duration-300"
        >
          <i class="fas fa-times"></i>
          <span>Cancel</span>
        </button>
      </div>
    </form>
  </div>
  <!-- End Edit User Form Section -->

  <!-- Main Content -->
  <!-- Users List Section -->

  <div class="overflow-x-auto rounded-xl">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th
            class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"
          >
            Actions
          </th>
          <th
            class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"
          >
            User Name
          </th>
          <th
            class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"
          >
            User Login
          </th>
          <th
            class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"
          >
            Designation
          </th>
          <th
            class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"
          >
            Email ID
          </th>
          <th
            class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"
          >
            Department
          </th>
          <th
            class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"
          >
            Unit Name
          </th>
          <th
            class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"
          >
            Status
          </th>
        </tr>
      </thead>
      <tbody [formGroup]="filterForm" class="bg-white divide-y divide-gray-200">
        <!-- Filter Row -->
        <tr class="bg-gray-50">
          <td class="px-6 py-3">
            <span class="text-sm text-gray-500">Actions</span>
          </td>
          <td class="px-6 py-3">
            <div class="relative">
              <input
                type="text"
                formControlName="userName"
                placeholder="Filter Name"
                class="w-full px-3 py-2 rounded-lg border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200 text-sm"
              />
              <button
                *ngIf="filterForm.get('userName')?.value"
                (click)="clearFilter('userName')"
                class="absolute inset-y-0 right-0 px-3 flex items-center text-gray-400 hover:text-gray-600"
              >
                <i class="fas fa-times"></i>
              </button>
            </div>
          </td>
          <td class="px-6 py-3">
            <div class="relative">
              <input
                type="text"
                formControlName="userLogin"
                placeholder="Filter Login"
                class="w-full px-3 py-2 rounded-lg border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200 text-sm"
              />
              <button
                *ngIf="filterForm.get('userLogin')?.value"
                (click)="clearFilter('userLogin')"
                class="absolute inset-y-0 right-0 px-3 flex items-center text-gray-400 hover:text-gray-600"
              >
                <i class="fas fa-times"></i>
              </button>
            </div>
          </td>
          <td class="px-6 py-3">
            <div class="relative">
              <input
                type="text"
                formControlName="designation"
                placeholder="Filter Designation"
                class="w-full px-3 py-2 rounded-lg border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200 text-sm"
              />
              <button
                *ngIf="filterForm.get('designation')?.value"
                (click)="clearFilter('designation')"
                class="absolute inset-y-0 right-0 px-3 flex items-center text-gray-400 hover:text-gray-600"
              >
                <i class="fas fa-times"></i>
              </button>
            </div>
          </td>
          <td class="px-6 py-3">
            <div class="relative">
              <input
                type="text"
                formControlName="emailId"
                placeholder="Filter Email"
                class="w-full px-3 py-2 rounded-lg border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200 text-sm"
              />
              <button
                *ngIf="filterForm.get('emailId')?.value"
                (click)="clearFilter('emailId')"
                class="absolute inset-y-0 right-0 px-3 flex items-center text-gray-400 hover:text-gray-600"
              >
                <i class="fas fa-times"></i>
              </button>
            </div>
          </td>
          <td class="px-6 py-3">
            <div class="relative">
              <input
                type="text"
                formControlName="department"
                placeholder="Filter Department"
                class="w-full px-3 py-2 rounded-lg border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200 text-sm"
              />
              <button
                *ngIf="filterForm.get('department')?.value"
                (click)="clearFilter('department')"
                class="absolute inset-y-0 right-0 px-3 flex items-center text-gray-400 hover:text-gray-600"
              >
                <i class="fas fa-times"></i>
              </button>
            </div>
          </td>
          <td class="px-6 py-3">
            <div class="relative">
              <input
                type="text"
                formControlName="unitName"
                placeholder="Filter Unit"
                class="w-full px-3 py-2 rounded-lg border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200 text-sm"
              />
              <button
                *ngIf="filterForm.get('unitName')?.value"
                (click)="clearFilter('unitName')"
                class="absolute inset-y-0 right-0 px-3 flex items-center text-gray-400 hover:text-gray-600"
              >
                <i class="fas fa-times"></i>
              </button>
            </div>
          </td>
          <td class="px-6 py-3">
            <div class="relative">
              <input
                type="text"
                formControlName="status"
                placeholder="Filter Status"
                class="w-full px-3 py-2 rounded-lg border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200 text-sm"
              />
              <button
                *ngIf="filterForm.get('status')?.value"
                (click)="clearFilter('status')"
                class="absolute inset-y-0 right-0 px-3 flex items-center text-gray-400 hover:text-gray-600"
              >
                <i class="fas fa-times"></i>
              </button>
            </div>
          </td>
        </tr>

        <!-- No Data Row -->
        <ng-container *ngIf="(paginatedUsers$ | async)?.length === 0">
          <tr>
            <td colspan="8" class="px-6 py-12 text-center">
              <div class="flex flex-col items-center space-y-3">
                <div
                  class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center"
                >
                  <i class="fas fa-users text-gray-400 text-2xl"></i>
                </div>
                <div>
                  <p class="text-gray-500 font-medium">No users found</p>
                  <p class="text-gray-400 text-sm">
                    No users match your criteria
                  </p>
                </div>
              </div>
            </td>
          </tr>
        </ng-container>

        <!-- Data Rows -->
        <ng-container
          *ngFor="let user of paginatedUsers$ | async; let i = index"
        >
          <tr class="hover:bg-gray-50 transition-colors duration-200">
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="flex items-center space-x-2">
                <button
                  (click)="editUser(user)"
                  class="flex items-center space-x-1 px-3 py-1 rounded-lg bg-blue-100 text-blue-700 hover:bg-blue-200 transition-colors duration-200"
                >
                  <i class="fas fa-edit text-sm"></i>
                  <span class="text-xs">Edit</span>
                </button>
              </div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="flex items-center">
                <div
                  class="w-8 h-8 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full flex items-center justify-center"
                >
                  <span class="text-white text-sm font-medium">{{
                    user.userName.charAt(0)
                  }}</span>
                </div>
                <div class="ml-3">
                  <div class="text-sm font-medium text-gray-900">
                    {{ user.userName }}
                  </div>
                </div>
              </div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="text-sm text-gray-900">{{ user.userLogin }}</div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="text-sm text-gray-900">{{ user.designation }}</div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="text-sm text-gray-900">{{ user.emailId }}</div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="text-sm text-gray-900">{{ user.department }}</div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="text-sm text-gray-900">{{ user.unitName }}</div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span
                class="status-badge"
                [ngClass]="{
                  'bg-green-100 text-green-800': user.status === 'Active',
                  'bg-red-100 text-red-800': user.status === 'Inactive',
                  'bg-yellow-100 text-yellow-800': user.status === 'Pending',
                  'bg-gray-100 text-gray-800': user.status === 'Suspended',
                }"
                >{{ user.status }}</span
              >
            </td>
          </tr>
        </ng-container>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div
    class="flex flex-col sm:flex-row justify-between items-center mt-6"
    *ngIf="totalPages > 0"
  >
    <div class="flex items-center space-x-2 text-sm text-gray-600">
      <span>Page {{ currentPage }} of {{ totalPages }}</span>
      <span class="text-gray-400">|</span>
      <span>{{ totalItems }} total users</span>
    </div>
    <div class="flex items-center space-x-1 sm:space-x-2 mt-4 sm:mt-0">
      <button
        (click)="previousPage()"
        [disabled]="currentPage === 1"
        class="flex items-center space-x-1 sm:space-x-2 px-2 sm:px-3 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 text-sm"
      >
        <i class="fas fa-chevron-left text-sm"></i>
        <span class="hidden sm:inline">Previous</span>
      </button>
      <div class="flex items-center space-x-1">
        <ng-container *ngFor="let page of pages">
          <button
            *ngIf="page !== '...'"
            (click)="goToPage(+page)"
            [class.bg-blue-600]="currentPage === page"
            [class.text-white]="currentPage === page"
            class="px-2 sm:px-3 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50 transition-all duration-200 text-sm min-w-[2.5rem] sm:min-w-[2.75rem]"
          >
            {{ page }}
          </button>
          <span
            *ngIf="page === '...'"
            class="px-2 sm:px-3 py-2 text-gray-400 text-sm"
            >...</span
          >
        </ng-container>
      </div>
      <button
        (click)="nextPage()"
        [disabled]="currentPage === totalPages"
        class="flex items-center space-x-1 sm:space-x-2 px-2 sm:px-3 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 text-sm"
      >
        <span class="hidden sm:inline">Next</span>
        <i class="fas fa-chevron-right text-sm"></i>
      </button>
    </div>
  </div>
</div>
